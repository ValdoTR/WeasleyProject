import{i as p,a as n,h as s,b as c,r as f,p as u}from"./sounds-525f857f.js";import{i as d,g as a}from"./job-81ec338e.js";import{t as e}from"./translate-a3054a4c.js";import{t as m}from"./layers-e0032f78.js";import{i as A}from"./secretPassages-56b942be.js";import{o as b}from"./discussion-42ef3b3e.js";import{n as h}from"./notifications-a1e8597b.js";import{h as W}from"./workadventureFeatures-e8ea4fd1.js";let t=null,l=null;const v=async()=>{const o=await WA.player.getPosition();WA.camera.set(o.x,o.y,100,100)};WA.onInit().then(async()=>{WA.camera.followPlayer(!0),WA.camera.set(665,838),await d(),W(),p([{name:"evilGuySound",path:"evilGuy.mp3"}]),v(),b(e("utils.mySelf"),e(`bomb.story.${a()}`),"views.choice.close","discussion","middle","middle","50vh","50vh",()=>{s("freeSpy")?(m("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}])):a()==="spy"&&(WA.controls.disablePlayerControls(),WA.player.setOutlineColor(255,0,0))}),WA.player.state.askForDefuseBomb===void 0&&(WA.player.state.askForDefuseBomb=!1),WA.player.state.askForBoom===void 0&&(WA.player.state.askForBoom=!1),A(["secretPassage"],[()=>{console.log("secret passage discovered !")}]),n("freeSpy",()=>{m("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}]),console.log("PLAYER JOB",a()),a()==="spy"&&(console.log("IS SPY"),WA.player.removeOutlineColor(),WA.controls.restorePlayerControls())}),n("boom",()=>{u("evilGuySound"),b(e("bomb.bomb.failure.name"),e("bomb.bomb.failure.message"),"views.choice.close","discussion")}),n("defuseBomb",()=>{m("bomb",!1),u("success"),y(),h(e("bomb.success"),e("utils.success"),"success")}),a()==="spy"&&WA.ui.actionBar.addButton({id:"cheatSheetButton",label:e("bomb.cheatSheet"),callback:async()=>{l?w():await g()}});let o=null;WA.room.onEnterLayer("saveSpyZone").subscribe(()=>{!s("boom")&&!s("defuseBomb")?b(e("utils.mySelf"),e("bomb.freeSpy.noTime"),"views.choice.close","discussion"):s("freeSpy")||(o=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.freeSpy.free")}),callback:()=>{c("freeSpy")}}),WA.room.onLeaveLayer("saveSpyZone").subscribe(()=>{o==null||o.remove(),o=null}))});let i=null;WA.room.onEnterLayer("bombZone").subscribe(()=>{!s("boom")&&!s("defuseBomb")&&(i=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.bomb.defuse")}),callback:async()=>{WA.controls.disablePlayerControls(),t=await WA.ui.website.open({url:`${f}/views/bomb/bomb.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})}})),WA.room.onLeaveLayer("bombZone").subscribe(()=>{i==null||i.remove(),i=null})}),WA.player.state.onVariableChange("askForBoom").subscribe(r=>{r&&(y(),c("boom"))}),WA.player.state.onVariableChange("askForDefuseBomb").subscribe(r=>{r&&c("defuseBomb")})});const g=async()=>{l=await WA.ui.website.open({url:`${f}/views/bomb/cheatSheet.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},w=()=>{l==null||l.close(),l=null},y=()=>{t==null||t.close(),t=null,WA.controls.restorePlayerControls()};
