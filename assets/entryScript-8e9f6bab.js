import{c as A,i as W,s as d}from"./job-be9a3c43.js";import{t as u}from"./translate-52a641a9.js";import{f as $}from"./lobby-840e0083.js";import{i as c,s as f}from"./readRunes-e2ededb5.js";import"./config-63dd91cb.js";let n=null;const y=(e=["excavationZone"],o=null)=>{if(A("makeExcavation"))for(let t=0;t<e.length;t++)WA.state[`${e[t]}Discovered`]?WA.room.showLayer(`${e[t]}/found`):(WA.room.showLayer(`${e[t]}/trace`),WA.room.onEnterLayer(`${e[t]}/trace`).subscribe(()=>{WA.state[`${e[t]}Discovered`]||(n=WA.ui.displayActionMessage({message:u("utils.executeAction",{action:u("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[t]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[t]}/trace`).subscribe(()=>{n==null||n.remove()}),WA.state.onVariableChange(`${e[t]}Discovered`).subscribe(()=>{h(e[t],o?o[t]:null)}))},h=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)};let s=null;const b=e=>{const o=WA.state.mapWidth,t=WA.state.mapHeight,i=[];for(let a=1;a<o;a++)for(let r=1;r<t;r++)i.push({x:a,y:r,tile:null,layer:`${e}/block`});WA.room.setTiles(i)},L=(e=["secretPassageZone"],o=null)=>{if(A("findSecretPassages"))for(let t=0;t<e.length;t++)WA.state[`${e[t]}Discovered`]?(WA.room.showLayer(`${e[t]}/found`),WA.room.hideLayer(`${e[t]}/disappear`)):(WA.room.showLayer(`${e[t]}/trace`),WA.room.onEnterLayer(`${e[t]}/trace`).subscribe(()=>{WA.state[`${e[t]}Discovered`]||(s=WA.ui.displayActionMessage({message:u("utils.executeAction",{action:u("modules.secretPassage.findSecretPassage")}),callback:()=>{WA.state[`${e[t]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[t]}/trace`).subscribe(()=>{s==null||s.remove()}),WA.state.onVariableChange(`${e[t]}Discovered`).subscribe(()=>{p(e[t],o?o[t]:null)}))},p=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),WA.room.hideLayer(`${e}/disappear`),b(e),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)},I=e=>{for(let o=0;o<e.length;o++)WA.room.onEnterLayer(e[o].stepIn).subscribe(()=>{WA.room.hideLayer(e[o].hide)}),WA.room.onLeaveLayer(e[o].stepIn).subscribe(()=>{WA.room.showLayer(e[o].hide)})},g=(e=["switchingTiles"],o=[])=>{for(let t=0;t<e.length;t++){const i=JSON.parse(WA.state[`${e[t]}VictoryCondition`]),a=WA.state[`${e[t]}TilesNumber`];for(let r=0;r<Object.keys(i).length;r++)m(e[t],r),WA.room.onEnterLayer(`${e[t]}/${r}_layer/zone`).subscribe(()=>{if(!WA.state[`${e[t]}IsVictory`]){let l=WA.state[`${e[t]}_${r}_value`]?WA.state[`${e[t]}_${r}_value`]:0;WA.state[`${e[t]}_${r}_value`]=(l+1)%a,_(e[t],i)&&(WA.state[`${e[t]}IsVictory`]=!0)}}),WA.state.onVariableChange(`${e[t]}IsVictory`).subscribe(l=>{l&&(o!=null&&o[t])&&o[t]()}),WA.state.onVariableChange(`${e[t]}_${r}_value`).subscribe(()=>{m(e[t],r)})}},_=(e,o)=>{for(let t=0;t<Object.keys(o).length;t++)if(WA.state[`${e}_${t}_value`]!=o[t])return!1;return!0},m=(e,o)=>{WA.room.hideLayer(`${e}/${o}_layer`),WA.room.showLayer(`${e}/${o}_layer/${WA.state[`${e}_${o}_value`]}`)};WA.onInit().then(()=>{console.log("INITIALISATION"),W(),d("spy"),console.log("HERE"),y(["excavation"],[()=>{console.log("test callback after excavation")}]),L(["secretPassage"],[()=>{console.log("test callback after finding secret passage")}]),I([{stepIn:"hiddenZoneFloor",hide:"hiddenZoneTop"}]),console.log("Initiate switching tiles"),g(["switchingTiles"],[()=>console.log("OK !")]),console.log("Initiate runes reading !"),c(),f("runeZone",{content:"Il était une fois, dans une royaume lointain, une magnifique princesse. Il était une fois, dans une royaume lointain, une magnifique princesse. Il était une fois, dans une royaume lointain, une magnifique princesse. Il était une fois, dans une royaume lointain, une magnifique princesse. Il était une fois, dans une royaume lointain, une magnifique princesse. Il était une fois, dans une royaume lointain, une magnifique princesse. ",title:"Cendrillon"}),console.log("LOBBY INITIALISATION"),$()}).catch(e=>console.error(e));
