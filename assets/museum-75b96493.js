import{b as F}from"./init-22028896.js";import{i as D,c as E}from"./job-dca0f96f.js";import{t as o}from"./translate-b062212e.js";import{t as i}from"./layers-e0032f78.js";import{i as R}from"./hiddenZone-8ca7275f.js";import{i as A,a as W,c as f,r as $}from"./actionForAllPlayers-1b20265c.js";import{o as a}from"./discussion-2918c9d6.js";import{i as T,h as b,d as v}from"./inventory-537726ca.js";import{s as S}from"./hooking-6f0acccd.js";import"./notifications-85d89afd.js";F();WA.onInit().then(()=>{D(),T();let p=!1,n=!1,m=null;const k=()=>{m=setInterval(()=>{i("lights/lights1",n),i("lights/lights2",!n),n=!n},300)},L=()=>{m&&clearInterval(m),m=null},C=()=>{k(),i("noLights/noLights",!1),i("noLights/conversations",!1),i("lights/conversations",!0)},w=()=>{L(),i("lights/lights1",!1),i("lights/lights2",!1),i("noLights/noLights",!0),i("noLights/conversations",!0),i("lights/conversations",!1)};S("hookingD7",()=>{const e=[];e.push({x:5,y:67,tile:null,layer:"hookingD7/collides"}),WA.room.setTiles(e)});let u=null;WA.room.onEnterLayer("closeDoorMessage").subscribe(()=>{u=WA.ui.displayActionMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("closeDoorMessage").subscribe(()=>{u==null||u.remove()});let d=null;WA.room.onEnterLayer("bigRoomAccess/keeperZone").subscribe(()=>{d=WA.ui.displayActionMessage({message:o("museum.speakToKeeper"),callback:()=>{if(b("id-card")){a("views.museum.keeperName","views.museum.bigRoomAccess");const e=[];e.push({x:25,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),e.push({x:26,y:44,tile:null,layer:"bigRoomAccess/bigRoomCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc6")}else a("views.museum.keeperName","views.museum.bigRoomNoAccess")}})}),WA.room.onLeaveLayer("bigRoomAccess/keeperZone").subscribe(()=>{d==null||d.remove()});let g=null;WA.room.onEnterLayer("beginZone").subscribe(()=>{p||(WA.controls.disablePlayerControls(),g=WA.ui.displayActionMessage({message:o("museum.beginBtn"),callback:()=>{a("Voix off","views.museum.beginText","Go !","Discussion","middle","middle","50vh","90vw",()=>{WA.controls.restorePlayerControls(),p=!0})}}))}),WA.room.onLeaveLayer("beginZone").subscribe(()=>{p||g==null||g.remove()});let h=null;WA.room.onEnterLayer("beginDiscussZone").subscribe(()=>{WA.controls.disablePlayerControls(),h=WA.ui.displayActionMessage({message:o("museum.speakToKeeper"),callback:()=>{a(WA.player.name,"views.museum.beginDiscussion","views.choice.close","discussion","bottom","middle","50vh","90vw",()=>{WA.controls.restorePlayerControls()})}})}),WA.room.onLeaveLayer("beginDiscussZone").subscribe(()=>{h==null||h.remove()});for(let e=1;e<8;e++)R([{stepIn:`fogsZone/fog${[e]}`,hide:`fogs/fog${[e]}`}]);const x=e=>{let s=null;WA.room.onEnterLayer(`search/s${e}`).subscribe(()=>{e===5&&!b("id-card")?s=WA.ui.displayActionMessage({message:o("museum.search"),callback:()=>{v({id:"id-card",name:"museum.idCardTitle",image:"myItem.png",description:"museum.idCardDescription"})}}):s=WA.ui.displayActionMessage({message:o("museum.search"),callback:()=>{s=WA.ui.displayActionMessage({message:o("museum.searchEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`search/s${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<8;e++)x(e);const M=e=>{let s=null;WA.room.onEnterLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s=WA.ui.displayActionMessage({message:o("museum.pickpocket"),callback:()=>{f("switchLights")?a(o("museum.guest"),o("museum.cannotPickPocket"),"views.choice.close","discussion","middle","middle","50vh","50vh",()=>{a(o("utils.mySelf"),o("museum.needDistraction"),"views.choice.close","discussion")}):e===8&&!b("access-card")?v({id:"access-card",name:"museum.accessCard",image:"myItem.png",description:"museum.accessCardDescription"}):s=WA.ui.displayActionMessage({message:o("museum.pickpocketEmpty"),callback:()=>{}})}})}),WA.room.onLeaveLayer(`pickPocketInvited/i${e}`).subscribe(()=>{s==null||s.remove()})};for(let e=1;e<13;e++)M(e);let t=null;WA.room.onEnterLayer("desktopAccessZone").subscribe(()=>{b("access-card")?t=WA.ui.displayActionMessage({message:o("museum.desktopOpen"),callback:()=>{t=WA.ui.displayActionMessage({message:o("museum.desktopOpenMsg"),callback:()=>{const e=[];e.push({x:38,y:11,tile:null,layer:"desktopCollides"}),e.push({x:39,y:11,tile:null,layer:"desktopCollides"}),WA.room.setTiles(e),WA.room.hideLayer("doorsClosed/dc4")}})}}):t=WA.ui.displayActionMessage({message:o("museum.doorClosed"),callback:()=>{}})}),WA.room.onLeaveLayer("desktopAccessZone").subscribe(()=>{t==null||t.remove()});for(let e=0;e<9;e++){let s=null;WA.room.onEnterLayer(`desktopItems/i${e}`).subscribe(()=>{s=WA.ui.displayActionMessage({message:o("museum.search"),callback:()=>{s=WA.ui.displayActionMessage({message:o(`museum.desktopItems${e}`),callback:()=>{e===0&&a("views.museum.annuaryTitle","views.museum.annuaryContent")}})}})}),WA.room.onLeaveLayer(`desktopItems/i${e}`).subscribe(()=>{s==null||s.remove()})}const r=["cameraZones/cZone1","cameraZones/cZone2","cameraZones/cZone3","cameraZones/cZone4","cameraZones/cZone5","cameraZones/cZone6"],Z={room1:{x:5*32,y:60*32,width:500,height:500},room2:{x:5*32,y:44*32,width:500,height:500},room3:{x:3*32,y:3*32,width:500,height:500},room4:{x:60*32,y:4*32,width:900,height:900},room5:{x:50*32,y:32*32,width:400,height:400},room6:{x:31*32,y:51*32,width:520,height:520},room7:{x:37*32,y:33*32,width:1e3,height:1e3}};let y=null;A("deactivateCamera",e=>{for(let s=0;s<r.length;s++)i(r[s],!0);i(e,!1),y===e&&WA.controls.restorePlayerControls()}),A("switchLights",e=>{e?C():w()},!0),WA.player.state.askForSwitchLights===void 0&&(WA.player.state.askForSwitchLights=!0),WA.player.state.askForDeactivateCamera===void 0&&(WA.player.state.askForDeactivateCamera=!1),WA.player.state.askForCloseComputerWebsite===void 0&&(WA.player.state.askForCloseComputerWebsite=!1),WA.player.state.askForSeeRoom===void 0&&(WA.player.state.askForSeeRoom=!1),WA.player.state.onVariableChange("askForDeactivateCamera").subscribe(e=>{e&&W("deactivateCamera",e)}),WA.player.state.onVariableChange("askForCloseComputerWebsite").subscribe(e=>{e&&P()}),WA.player.state.onVariableChange("askForSwitchLights").subscribe(e=>{W("switchLights",e)}),WA.player.state.onVariableChange("askForSeeRoom").subscribe(e=>{const s=Z["room"+e];WA.camera.set(s.x,s.y,s.width,s.height,!1,!1),i(`fogs/fog${e}`,!1)});for(let e=0;e<r.length;e++)WA.room.onEnterLayer(r[e]).subscribe(()=>{f("deactivateCamera")!==r[e]&&(y=r[e],a("utils.mySelf","museum.cannotWalkInCameras","utils.close","discussion","bottom","middle","50vh","50vh",()=>{WA.controls.disablePlayerControls()}))});let l=null;const I=async()=>{l=await WA.ui.website.open({url:`${$}/views/museum/buildingMap.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"right"},size:{height:"100vh",width:"50vw"}}),WA.controls.disablePlayerControls(),WA.player.state.askForCloseComputerWebsite=!1},P=()=>{l==null||l.close(),l=null,WA.controls.restorePlayerControls()};let c=null;WA.room.onEnterLayer("computerZone").subscribe(()=>{c=WA.ui.displayActionMessage({message:o("utils.executeAction",{action:o("utils.hack")}),callback:()=>{E("useComputers")?I():a("utils.mySelf","museum.cannotUseComputers","utils.close","discussion")}})}),WA.room.onLeaveLayer("computerZone").subscribe(()=>{c==null||c.remove(),c=null})});
