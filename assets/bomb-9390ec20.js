import{i as p,r as y,a as b,h as o,b as m,p as d}from"./sounds-961d1df1.js";import{i as A,g as a}from"./job-1fdfc9c6.js";import{t as e}from"./translate-22b8282f.js";import{t as c}from"./layers-e0032f78.js";import{i as h}from"./secretPassages-d8fb5dac.js";import{o as u}from"./discussion-296f6ef1.js";import{n as W}from"./notifications-03c7fa8b.js";import{h as v}from"./workadventureFeatures-48ab46db.js";let t=null,s=null;const S=async()=>{const r=await WA.player.getPosition();WA.camera.set(r.x,r.y,100,100)};WA.onInit().then(async()=>{WA.camera.followPlayer(!0),WA.camera.set(665,838),await A(),v(),p([{name:"evilGuySound",path:"evilGuy.mp3"}]),WA.sound.loadSound(`${y}/sounds/bomb.mp3`).play({volume:.3,loop:!0,rate:1,detune:1,delay:0,seek:0,mute:!1}),S(),u(e("utils.mySelf"),e(`bomb.story.${a()}`),"views.choice.close","discussion","middle","middle","50vh","50vh",()=>{o("freeSpy")?(c("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}])):a()==="spy"&&(WA.controls.disablePlayerControls(),WA.player.setOutlineColor(255,0,0))}),WA.player.state.askForDefuseBomb=!1,WA.player.state.askForBoom=!1,h(["secretPassage"],[()=>{console.log("secret passage discovered !")}]),b("freeSpy",()=>{c("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}]),a()==="spy"&&(WA.player.removeOutlineColor(),WA.controls.restorePlayerControls())}),b("boom",()=>{d("evilGuySound"),u(e("bomb.bomb.failure.name"),e("bomb.bomb.failure.message"),"views.choice.close","discussion","middle","middle","50vh","50vh",()=>{a()==="spy"&&WA.controls.disablePlayerControls()})}),b("defuseBomb",()=>{c("bomb",!1),f(),d("successSound"),W(e("bomb.bomb.success"),e("utils.success"),"success")}),a()==="spy"&&WA.ui.actionBar.addButton({id:"cheatSheetButton",label:e("bomb.cheatSheet"),callback:async()=>{s?g():await w()}});let l=null;WA.room.onEnterLayer("saveSpyZone").subscribe(()=>{!o("boom")&&!o("defuseBomb")?u(e("utils.mySelf"),e("bomb.freeSpy.noTime"),"views.choice.close","discussion"):o("freeSpy")||(l=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.freeSpy.free")}),callback:()=>{m("freeSpy")}}),WA.room.onLeaveLayer("saveSpyZone").subscribe(()=>{l==null||l.remove(),l=null}))});let i=null;WA.room.onEnterLayer("bombZone").subscribe(()=>{!o("boom")&&!o("defuseBomb")&&(i=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.bomb.defuse")}),callback:async()=>{WA.controls.disablePlayerControls(),t=await WA.ui.website.open({url:`${y}/views/bomb/bomb.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})}})),WA.room.onLeaveLayer("bombZone").subscribe(()=>{i==null||i.remove(),i=null})}),WA.player.state.onVariableChange("askForBoom").subscribe(n=>{n&&(f(),m("boom"))}),WA.player.state.onVariableChange("askForDefuseBomb").subscribe(n=>{n&&m("defuseBomb")})});const w=async()=>{s=await WA.ui.website.open({url:`${y}/views/bomb/cheatSheet.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},g=()=>{s==null||s.close(),s=null},f=()=>{t&&(t.close(),t=null,WA.controls.restorePlayerControls())};
