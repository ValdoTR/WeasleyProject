import{c as W,i as $,s as u}from"./job-7b1d3359.js";import{t as A}from"./translate-ea8f1c55.js";import{f as c}from"./lobby-840e0083.js";import"./config-63dd91cb.js";let l=null;const d=(e=["excavationZone"],o=null)=>{if(W("makeExcavation"))for(let t=0;t<e.length;t++)WA.state[`${e[t]}Discovered`]?WA.room.showLayer(`${e[t]}/found`):(WA.room.showLayer(`${e[t]}/trace`),WA.room.onEnterLayer(`${e[t]}/trace`).subscribe(()=>{WA.state[`${e[t]}Discovered`]||(l=WA.ui.displayActionMessage({message:A("utils.executeAction",{action:A("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[t]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[t]}/trace`).subscribe(()=>{l==null||l.remove()}),WA.state.onVariableChange(`${e[t]}Discovered`).subscribe(()=>{h(e[t],o?o[t]:null)}))},h=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)};let s=null;const b=e=>{const o=WA.state.mapWidth,t=WA.state.mapHeight,a=[];for(let i=1;i<o;i++)for(let r=1;r<t;r++)a.push({x:i,y:r,tile:null,layer:`${e}/block`});WA.room.setTiles(a)},y=(e=["secretPassageZone"],o=null)=>{if(W("findSecretPassages"))for(let t=0;t<e.length;t++)WA.state[`${e[t]}Discovered`]?(WA.room.showLayer(`${e[t]}/found`),WA.room.hideLayer(`${e[t]}/disappear`)):(WA.room.showLayer(`${e[t]}/trace`),WA.room.onEnterLayer(`${e[t]}/trace`).subscribe(()=>{WA.state[`${e[t]}Discovered`]||(s=WA.ui.displayActionMessage({message:A("utils.executeAction",{action:A("modules.secretPassage.findSecretPassage")}),callback:()=>{WA.state[`${e[t]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[t]}/trace`).subscribe(()=>{s==null||s.remove()}),WA.state.onVariableChange(`${e[t]}Discovered`).subscribe(()=>{f(e[t],o?o[t]:null)}))},f=(e,o=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),WA.room.hideLayer(`${e}/disappear`),b(e),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),o&&o()},1e3)},3e3)},L=e=>{for(let o=0;o<e.length;o++)WA.room.onEnterLayer(e[o].stepIn).subscribe(()=>{WA.room.hideLayer(e[o].hide)}),WA.room.onLeaveLayer(e[o].stepIn).subscribe(()=>{WA.room.showLayer(e[o].hide)})},p=(e=["switchingTiles"],o=[])=>{for(let t=0;t<e.length;t++){const a=JSON.parse(WA.state[`${e[t]}VictoryCondition`]),i=WA.state[`${e[t]}TilesNumber`];for(let r=0;r<Object.keys(a).length;r++)n(e[t],r),WA.room.onEnterLayer(`${e[t]}/${r}_layer/zone`).subscribe(()=>{if(!WA.state[`${e[t]}IsVictory`]){let m=WA.state[`${e[t]}_${r}_value`]?WA.state[`${e[t]}_${r}_value`]:0;WA.state[`${e[t]}_${r}_value`]=(m+1)%i,I(e[t],a)&&(WA.state[`${e[t]}IsVictory`]=!0)}}),WA.state.onVariableChange(`${e[t]}IsVictory`).subscribe(m=>{m&&(o!=null&&o[t])&&o[t]()}),WA.state.onVariableChange(`${e[t]}_${r}_value`).subscribe(()=>{n(e[t],r)})}},I=(e,o)=>{for(let t=0;t<Object.keys(o).length;t++)if(WA.state[`${e}_${t}_value`]!=o[t])return!1;return!0},n=(e,o)=>{WA.room.hideLayer(`${e}/${o}_layer`),WA.room.showLayer(`${e}/${o}_layer/${WA.state[`${e}_${o}_value`]}`)};WA.onInit().then(()=>{console.log("INITIALISATION"),$(),u("spy"),console.log("HERE"),d(["excavation"],[()=>{console.log("test callback after excavation")}]),y(["secretPassage"],[()=>{console.log("test callback after finding secret passage")}]),L([{stepIn:"hiddenZoneFloor",hide:"hiddenZoneTop"}]),console.log("Initiate switching tiles"),p(["switchingTiles"],[()=>console.log("OK !")]),console.log("LOBBY INITIALISATION"),c()}).catch(e=>console.error(e));
