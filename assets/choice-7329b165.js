import{i as g,r as A,g as i,s as m}from"./job-1fdfc9c6.js";import{t as e}from"./translate-22b8282f.js";import{r as f}from"./sounds-961d1df1.js";import{o as b}from"./discussion-296f6ef1.js";import{i as h,g as d,d as W}from"./inventory-cb1b4c97.js";import{h as v}from"./workadventureFeatures-48ab46db.js";import"./notifications-03c7fa8b.js";const n=async()=>(await WA.players.configureTracking(),WA.players.list()),p=async()=>{const s=await n();let t=0;for(let r of s)if(t++,!r.state.job)return!1;return t>0?(WA.state.allPlayersGotJob=!0,!0):!1};WA.onInit().then(async()=>{const s=WA.sound.loadSound(`${f}/sounds/choice.mp3`);let t={volume:.2,loop:!0,rate:1,detune:1,delay:0,seek:0,mute:!1};s.play(t),h(),await g(),v(),b("utils.voiceOver","choice.scenario"),WA.state.onVariableChange("allPlayersGotJob").subscribe(o=>{o&&WA.nav.goToRoom("./museum.tmj")}),A();let r;WA.room.onEnterLayer("talk").subscribe(()=>{r=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("choice.talk")}),callback:()=>{b("views.choice.title","views.choice.text")}})}),WA.room.onLeaveLayer("talk").subscribe(()=>{r.remove()});let l;WA.room.onEnterLayer("spy").subscribe(async()=>{const o=await n();let a=!1;for(let c of o)c.state.job==="spy"&&(a=!0);!a&&!i()&&(l=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("choice.spyMessage")}),callback:()=>{m("spy"),console.log(i()),p()}}))}),WA.room.onLeaveLayer("spy").subscribe(()=>{l.remove()});let u;WA.room.onEnterLayer("archeo").subscribe(async()=>{const o=await n();let a=!1;for(let c of o)c.state.job==="archaeologist"&&(a=!0);!a&&!i()&&(u=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("choice.archeoMessage")}),callback:()=>{m("archaeologist"),console.log(i()),p()}}))}),WA.room.onLeaveLayer("archeo").subscribe(()=>{u.remove()});let y;WA.room.onEnterLayer("croissants").subscribe(()=>{y=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("choice.takeCroissantMessage")}),callback:()=>{const o=d().length;W({id:`croissant${o}`,name:"Croissant",description:"choice.looksDelicious",image:"croissant.png"})}})}),WA.room.onLeaveLayer("croissants").subscribe(()=>{y.remove()})}).catch(s=>console.error(s));
