import{i as m,g as c}from"./job-280f8f30.js";import{t as e,w as g,a as b}from"./layers-e0032f78.js";import{t as r}from"./translate-d49d6517.js";import{s as y}from"./switchingTiles-a07d39c2.js";import{o as p}from"./discussion-c0882e96.js";import{i as h,s as A}from"./readRunes-abd028e9.js";import{i as d,h as t,d as f}from"./inventory-09287260.js";import{n as v}from"./notifications-9bf53ede.js";import{i as k,c as W,a as i,h as l,b as n,p as u}from"./sounds-6be04f48.js";WA.onInit().then(async()=>{await m(),k([{name:"evilGuySound",path:"evilGuy.mp3"}]),d(),h(),A("runesReading",{content:"treasureEnigma.runes.content"});let s=null;y("rotatingStatues",()=>{v("treasureEnigma.hammer.opened","utils.success","success"),e("hammerZoneTop",!1),WA.room.onEnterLayer("hammerZone").subscribe(()=>{t("hammer")||(s=WA.ui.displayActionMessage({message:r("utils.executeAction",{action:r("treasureEnigma.hammer.action")}),callback:()=>{f({id:"hammer",name:"treasureEnigma.hammer.name",image:"hammer.png",description:"treasureEnigma.hammer.description"}),e("hammerZone",!1)}}))}),WA.room.onLeaveLayer("hammerZone").subscribe(()=>{s==null||s.remove(),s=null})},!0,"treasureEnigma.makeTurn");let a=null;W("openTreasureDoor",["breakHourglass1","breakHourglass2"],()=>{u("successSound"),e("torchesOnBottom",!0),e("torchesOnTop",!0),e("treasureDoor",!1),WA.room.setTiles([{x:14,y:13,tile:null,layer:"treasureDoorCollisions"},{x:15,y:13,tile:null,layer:"treasureDoorCollisions"},{x:16,y:13,tile:null,layer:"treasureDoorCollisions"}])}),i("breakHourglass1",()=>{e("hourglass1FullBottom",!1),e("hourglass1FullTop",!1),e("hourglass1BrokenTop",!0),e("hourglass1BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass1Zone").subscribe(()=>{t("hammer")&&!l("breakHourglass1")&&(a=WA.ui.displayActionMessage({message:r("utils.executeAction",{action:r("treasureEnigma.breakHourglass")}),callback:()=>{n("breakHourglass1")}}))}),WA.room.onLeaveLayer("breakHourglass1Zone").subscribe(()=>{a==null||a.remove(),a=null}),i("breakHourglass2",()=>{e("hourglass2FullBottom",!1),e("hourglass2FullTop",!1),e("hourglass2BrokenTop",!0),e("hourglass2BrokenBottom",!0)}),WA.room.onEnterLayer("breakHourglass2Zone").subscribe(()=>{t("hammer")&&!l("breakHourglass2")&&(a=WA.ui.displayActionMessage({message:r("utils.executeAction",{action:r("treasureEnigma.breakHourglass")}),callback:()=>{n("breakHourglass2")}}))}),WA.room.onLeaveLayer("breakHourglass2Zone").subscribe(()=>{a==null||a.remove(),a=null}),i("evilGuyAppears",async()=>{WA.controls.disablePlayerControls(),WA.camera.set(15*32+16,4*32+16,50,50,!0,!0),u("evilGuySound"),await g(1e3),setTimeout(()=>{e("badGuy",!0)},300),await b(["pouf1","pouf2","pouf3"],100),setTimeout(()=>{p("treasureEnigma.badGuy.name","treasureEnigma.badGuy.monologue","views.choice.close","discussion","bottom","middle","30vh","100vw",()=>{WA.nav.goToRoom(`./bomb.tmj#${c()}-entry`)})},300)});let o=null;WA.room.onEnterLayer("treasure").subscribe(()=>{o=WA.ui.displayActionMessage({message:r("utils.executeAction",{action:r("treasureEnigma.takeTheTreasure")}),callback:()=>{n("evilGuyAppears")}})}),WA.room.onLeaveLayer("treasure").subscribe(()=>{o==null||o.remove(),o=null})});
