import{b as c}from"./init-22028896.js";import{t as a}from"./translate-b149c22e.js";import{o as u}from"./discussion-c2c87534.js";import"./sounds-ea3a6419.js";c();const b=s=>{let o=s.length,n;for(;o>0;)n=Math.floor(Math.random()*o),o--,[s[o],s[n]]=[s[n],s[o]];return s};WA.onInit().then(()=>{WA.player.state.isInSelectionZone=!1;const s=()=>{WA.state.playersInSelectionZone="",WA.state.randomDuos=null,WA.state.askForRandomDuos=!0,setTimeout(()=>{let l={},e=WA.state.playersInSelectionZone.split("/");console.log("PLAYERS",e);const r=new RegExp("^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$");if(e=e.filter(t=>t!==""&&t.match(r)),console.log("PLAYERS AFTER EMAIL REGEX",e),console.log("PLAYERS LENGTH",e.length),e.length%2===0&&e.length>0){e=b(e);for(let t=0;t<e.length;t+=2){const i=e[t]+"-"+e[t+1];l[e[t]]=i,l[e[t+1]]=i}WA.state.randomDuos=JSON.stringify(l)}else WA.ui.banner.openBanner({id:"banner-players-not-even",text:a("lobby.notValid"),bgColor:"#ff0000",textColor:"#ffffff",closable:!0});WA.state.askForRandomDuos=!1},1e3)};let o=null;WA.room.onEnterLayer("random_zone").subscribe(()=>{o=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.activateRandom")}),callback:()=>{s()}})}),WA.room.onLeaveLayer("random_zone").subscribe(()=>{o==null||o.remove(),o=null}),WA.room.onEnterLayer("selection_zone").subscribe(()=>{WA.player.state.isInSelectionZone=!0,WA.room.setTiles([{x:4,y:14,tile:"block",layer:"collisions"},{x:5,y:14,tile:"block",layer:"collisions"},{x:6,y:14,tile:"block",layer:"collisions"}])}),WA.state.onVariableChange("askForRandomDuos").subscribe(l=>{l&&WA.player.state.isInSelectionZone&&(WA.state.playersInSelectionZone=WA.state.playersInSelectionZone+"/"+WA.player.uuid)}),WA.state.onVariableChange("randomDuos").subscribe(l=>{if(l){const r=JSON.parse(l)[WA.player.uuid];WA.nav.goToPage(`https://play.workadventu.re/_/${r}/morganehuebra.github.io/WeasleyProject/maps/choice.tmj`)}});let n=null;WA.room.onEnterLayer("infos_zone").subscribe(()=>{n=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.displayInfos")}),callback:()=>{u("lobby.infoPanel","lobby.whatIsThat")}})}),WA.room.onLeaveLayer("infos_zone").subscribe(()=>{n==null||n.remove(),n=null})});
