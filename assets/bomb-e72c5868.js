import{i as n,h as o,a as c,r as y}from"./actionForAllPlayers-ba9bebea.js";import{i as f,s as A,g as t}from"./job-f83e1f24.js";import{t as e}from"./translate-b062212e.js";import{t as b}from"./layers-e0032f78.js";import{i as p}from"./secretPassages-bbfcf57d.js";import{o as m}from"./discussion-f4efe521.js";import{n as d}from"./notifications-2718926c.js";let a=null,s=null;WA.onInit().then(()=>{WA.camera.followPlayer(!0),WA.camera.set(665,838),f(),A("archaeologist"),m(e("utils.mySelf"),e(`bomb.story.${t()}`),"views.choice.close","discussion","middle","middle","50vh","50vh",()=>{o("freeSpy")?(b("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}])):t()==="spy"&&(WA.controls.disablePlayerControls(),WA.player.setOutlineColor(255,0,0))}),WA.player.state.askForDefuseBomb===void 0&&(WA.player.state.askForDefuseBomb=!1),WA.player.state.askForBoom===void 0&&(WA.player.state.askForBoom=!1),WA.onInit().then(()=>{p(["secretPassage"],[()=>{console.log("secret passage discovered !")}])}),n("freeSpy",()=>{b("rock",!1),WA.room.setTiles([{x:15,y:7,tile:null,layer:"rockCollisions"},{x:15,y:8,tile:null,layer:"rockCollisions"}]),t()==="spy"&&(WA.player.removeOutlineColor(),WA.controls.restorePlayerControls())}),n("boom",()=>{m(e("bomb.bomb.failure.name"),e("bomb.bomb.failure.message"),"views.choice.close","discussion")}),n("defuseBomb",()=>{b("bomb",!1),u(),d(e("bomb.success"),e("utils.success"),"success")}),t()==="spy"&&WA.ui.actionBar.addButton({id:"cheatSheetButton",label:e("bomb.cheatSheet"),callback:async()=>{s?W():await h()}});let l=null;WA.room.onEnterLayer("saveSpyZone").subscribe(()=>{!o("boom")&&!o("defuseBomb")?m(e("utils.mySelf"),e("bomb.freeSpy.noTime"),"views.choice.close","discussion"):o("freeSpy")||(l=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.freeSpy.free")}),callback:()=>{c("freeSpy")}}),WA.room.onLeaveLayer("saveSpyZone").subscribe(()=>{l==null||l.remove(),l=null}))});let i=null;WA.room.onEnterLayer("bombZone").subscribe(()=>{!o("boom")&&!o("defuseBomb")&&(i=WA.ui.displayActionMessage({message:e("utils.executeAction",{action:e("bomb.bomb.defuse")}),callback:async()=>{WA.controls.disablePlayerControls(),a=await WA.ui.website.open({url:`${y}/views/bomb/bomb.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})}})),WA.room.onLeaveLayer("bombZone").subscribe(()=>{i==null||i.remove(),i=null})}),WA.player.state.onVariableChange("askForBoom").subscribe(r=>{r&&(u(),c("boom"))}),WA.player.state.onVariableChange("askForDefuseBomb").subscribe(r=>{r&&c("defuseBomb")})});const h=async()=>{s=await WA.ui.website.open({url:`${y}/views/bomb/cheatSheet.html`,allowApi:!0,allowPolicy:"",position:{vertical:"middle",horizontal:"middle"},size:{height:"50vh",width:"50vw"}})},W=()=>{s==null||s.close(),s=null},u=()=>{a==null||a.close(),a=null,WA.controls.restorePlayerControls()};
