import{b as u}from"./init-22028896.js";import{t as a}from"./translate-b149c22e.js";import{o as b}from"./discussion-c2c87534.js";import"./sounds-ea3a6419.js";u();const m=n=>{let o=n.length,t;for(;o>0;)t=Math.floor(Math.random()*o),o--,[n[o],n[t]]=[n[t],n[o]];return n},c=n=>window.btoa(n);WA.onInit().then(()=>{WA.player.state.isInSelectionZone=!1;const n=()=>{WA.state.playersInSelectionZone="",WA.state.randomDuos=null,WA.state.askForRandomDuos=!0;let e=[];WA.state.onVariableChange("playersInSelectionZone").subscribe(l=>{l&&(console.log("NEW PLAYER",l),e.push(l))}),setTimeout(()=>{let l={};console.log("PLAYERS",e);const r=new RegExp("^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$");if(e=e.filter(s=>s!==""&&s.match(r)),console.log("PLAYERS AFTER EMAIL REGEX",e),console.log("PLAYERS LENGTH",e.length),e.length%2===0&&e.length>0){e=m(e);for(let s=0;s<e.length;s+=2){const i=c(e[s])+"-"+c(e[s+1]);l[e[s]]=i,l[e[s+1]]=i}WA.state.randomDuos=JSON.stringify(l)}else WA.ui.banner.openBanner({id:"banner-players-not-even",text:a("lobby.notValid"),bgColor:"#ff0000",textColor:"#ffffff",closable:!0});WA.state.askForRandomDuos=!1},1e3)};let o=null;WA.room.onEnterLayer("random_zone").subscribe(()=>{o=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.activateRandom")}),callback:()=>{n()}})}),WA.room.onLeaveLayer("random_zone").subscribe(()=>{o==null||o.remove(),o=null}),WA.room.onEnterLayer("selection_zone").subscribe(()=>{WA.player.state.isInSelectionZone=!0,WA.room.setTiles([{x:4,y:14,tile:"block",layer:"collisions"},{x:5,y:14,tile:"block",layer:"collisions"},{x:6,y:14,tile:"block",layer:"collisions"}])}),WA.state.onVariableChange("askForRandomDuos").subscribe(e=>{e&&WA.player.state.isInSelectionZone&&(WA.state.playersInSelectionZone=WA.player.uuid)}),WA.state.onVariableChange("randomDuos").subscribe(e=>{if(e){const r=JSON.parse(e)[WA.player.uuid];r&&WA.nav.goToPage(`https://play.workadventu.re/_/${r}/morganehuebra.github.io/WeasleyProject/maps/choice.tmj`)}});let t=null;WA.room.onEnterLayer("infos_zone").subscribe(()=>{t=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.displayInfos")}),callback:()=>{b("lobby.infoPanel","lobby.whatIsThat")}})}),WA.room.onLeaveLayer("infos_zone").subscribe(()=>{t==null||t.remove(),t=null})});
