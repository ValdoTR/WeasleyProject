import{b as u}from"./init-22028896.js";import{t as a}from"./translate-22b8282f.js";import{o as i}from"./discussion-296f6ef1.js";import"./sounds-961d1df1.js";u();const m=t=>{let n=t.length,s;for(;n>0;)s=Math.floor(Math.random()*n),n--,[t[n],t[s]]=[t[s],t[n]];return t},c=t=>window.btoa(t),b=new RegExp("^[\\w-\\.]+@([\\w-]+\\.)+[\\w-]{2,4}$");WA.onInit().then(()=>{WA.player.state.isInSelectionZone=!1;const t=()=>{WA.state.playersInSelectionZone="",WA.state.randomDuos=null,WA.state.askForRandomDuos=!0;let e=[];WA.state.onVariableChange("playersInSelectionZone").subscribe(l=>{l&&(console.log("NEW PLAYER",l),e.push(l))}),setTimeout(()=>{let l={};if(console.log("PLAYERS",e),e=e.filter(o=>o!==""&&o.match(b)),console.log("PLAYERS AFTER EMAIL REGEX",e),console.log("PLAYERS LENGTH",e.length),e.length%2===0&&e.length>0){e=m(e);for(let o=0;o<e.length;o+=2){const r=c(e[o])+"-"+c(e[o+1]);l[e[o]]=r,l[e[o+1]]=r}WA.state.randomDuos=JSON.stringify(l)}else WA.ui.banner.openBanner({id:"banner-players-not-even",text:a("lobby.notValid"),bgColor:"#ff0000",textColor:"#ffffff",closable:!0});WA.state.askForRandomDuos=!1},1e3)};let n=null;WA.room.onEnterLayer("random_zone").subscribe(()=>{n=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.activateRandom")}),callback:()=>{t()}})}),WA.room.onLeaveLayer("random_zone").subscribe(()=>{n==null||n.remove(),n=null}),WA.room.onEnterLayer("selection_zone").subscribe(async()=>{WA.player.uuid.match(b)?(WA.player.state.isInSelectionZone=!0,WA.room.setTiles([{x:4,y:14,tile:"block",layer:"collisions"},{x:5,y:14,tile:"block",layer:"collisions"},{x:6,y:14,tile:"block",layer:"collisions"}])):(WA.controls.disablePlayerControls(),await WA.player.moveTo(5*32,15*32),WA.controls.restorePlayerControls(),i("lobby.admin","lobby.connectToParticipate"))}),WA.state.onVariableChange("askForRandomDuos").subscribe(e=>{e&&WA.player.state.isInSelectionZone&&(WA.state.playersInSelectionZone=WA.player.uuid)}),WA.state.onVariableChange("randomDuos").subscribe(e=>{if(e){const o=JSON.parse(e)[WA.player.uuid];o&&WA.nav.goToPage(`https://play.workadventu.re/_/${o}/morganehuebra.github.io/WeasleyProject/maps/choice.tmj`)}});let s=null;WA.room.onEnterLayer("infos_zone").subscribe(()=>{s=WA.ui.displayActionMessage({message:a("utils.executeAction",{action:a("lobby.displayInfos")}),callback:()=>{i("lobby.infoPanel","lobby.whatIsThat")}})}),WA.room.onLeaveLayer("infos_zone").subscribe(()=>{s==null||s.remove(),s=null})});
