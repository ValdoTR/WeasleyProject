import{c as u,i as m,s as W}from"./job-7b1d3359.js";import{t as s}from"./translate-ea8f1c55.js";import{f as c}from"./lobby-840e0083.js";import"./config-63dd91cb.js";let i=null;const d=(e=["excavationZone"],t=null)=>{if(u("makeExcavation"))for(let o=0;o<e.length;o++)WA.state[`${e[o]}Discovered`]?WA.room.showLayer(`${e[o]}/found`):(WA.room.showLayer(`${e[o]}/trace`),WA.room.onEnterLayer(`${e[o]}/trace`).subscribe(()=>{WA.state[`${e[o]}Discovered`]||(i=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("modules.excavation.makeExcavations")}),callback:()=>{WA.state[`${e[o]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[o]}/trace`).subscribe(()=>{i==null||i.remove()}),WA.state.onVariableChange(`${e[o]}Discovered`).subscribe(()=>{b(e[o],t?t[o]:null)}))},b=(e,t=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),t&&t()},1e3)},3e3)};let l=null;const y=e=>{const t=[];for(let o=1;o<31;o++)for(let a=1;a<21;a++)t.push({x:o,y:a,tile:null,layer:`${e}/block`});WA.room.setTiles(t),console.log("salut")},f=(e=["secretPassageZone"],t=null)=>{if(u("findSecretPassages"))for(let o=0;o<e.length;o++)WA.state[`${e[o]}Discovered`]?(WA.room.showLayer(`${e[o]}/found`),WA.room.hideLayer(`${e[o]}/disappear`)):(WA.room.showLayer(`${e[o]}/trace`),WA.room.onEnterLayer(`${e[o]}/trace`).subscribe(()=>{WA.state[`${e[o]}Discovered`]||(l=WA.ui.displayActionMessage({message:s("utils.executeAction",{action:s("modules.secretPassage.findSecretPassage")}),callback:()=>{WA.state[`${e[o]}Discovered`]=!0}}))}),WA.room.onLeaveLayer(`${e[o]}/trace`).subscribe(()=>{l==null||l.remove()}),WA.state.onVariableChange(`${e[o]}Discovered`).subscribe(()=>{h(e[o],t?t[o]:null)}))},h=(e,t=null)=>{WA.room.hideLayer(`${e}/trace`),WA.room.showLayer(`${e}/search`),setTimeout(()=>{WA.room.showLayer(`${e}/found`),WA.room.hideLayer(`${e}/disappear`),y(e),setTimeout(()=>{WA.room.hideLayer(`${e}/search`),t&&t()},1e3)},3e3)},L=e=>{for(let t=0;t<e.length;t++)WA.room.onEnterLayer(e[t].stepIn).subscribe(()=>{WA.room.hideLayer(e[t].hide)}),WA.room.onLeaveLayer(e[t].stepIn).subscribe(()=>{WA.room.showLayer(e[t].hide)})},I=(e=["switchingTiles"],t=[])=>{for(let o=0;o<e.length;o++){const a=JSON.parse(WA.state[`${e[o]}VictoryCondition`]),$=WA.state[`${e[o]}TilesNumber`];for(let r=0;r<Object.keys(a).length;r++)n(e[o],r),WA.room.onEnterLayer(`${e[o]}/${r}_layer/zone`).subscribe(()=>{if(!WA.state[`${e[o]}IsVictory`]){let A=WA.state[`${e[o]}_${r}_value`]?WA.state[`${e[o]}_${r}_value`]:0;WA.state[`${e[o]}_${r}_value`]=(A+1)%$,p(e[o],a)&&(WA.state[`${e[o]}IsVictory`]=!0)}}),WA.state.onVariableChange(`${e[o]}IsVictory`).subscribe(A=>{A&&(t!=null&&t[o])&&t[o]()}),WA.state.onVariableChange(`${e[o]}_${r}_value`).subscribe(()=>{n(e[o],r)})}},p=(e,t)=>{for(let o=0;o<Object.keys(t).length;o++)if(WA.state[`${e}_${o}_value`]!=t[o])return!1;return!0},n=(e,t)=>{WA.room.hideLayer(`${e}/${t}_layer`),WA.room.showLayer(`${e}/${t}_layer/${WA.state[`${e}_${t}_value`]}`)};WA.onInit().then(()=>{console.log("INITIALISATION"),m(),W("spy"),console.log("HERE"),d(["excavation"],[()=>{console.log("test callback after excavation")}]),f(["secretPassage"],[()=>{console.log("test callback after finding secret passage")}]),L([{stepIn:"hiddenZoneFloor",hide:"hiddenZoneTop"}]),console.log("Initiate switching tiles"),I(["switchingTiles"],[()=>console.log("OK !")]),console.log("LOBBY INITIALISATION"),c()}).catch(e=>console.error(e));
